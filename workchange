import os

paths = "F:\人工智能\第三阶段-上"
log_dir_name = "视频"
log_file = "C:\\Users\\Mloong\\Desktop\\testpy.py"

def get_name_from_dir(path):
    filename = path[-1]
    for i in range(1,len(path)+1,10):
        temp = path[-i-10:-i]
        names = temp.split(os.sep)
        if names:
            filename = names[-1] + filename
            return filename
    return path

def list_dir(path,filename):
    file_lst = []
    def list_as(path,filename,file_lst):
        if os.path.isfile(path):
            return
        if get_name_from_dir(path) == filename:
            file_lst.append(path)
        dirs = [os.path.join(path,x) for x in os.listdir(path)]
        for filedir in dirs:
            list_as(filedir,filename,file_lst)
    list_as(path,filename,file_lst)
    return file_lst
    
   import shutil
   
   def copy_file(filedir,path):
    assert os.path.isfile(filedir),"{} not exist".format(filedir)
    if isinstance(path,str):
        if os.path.exists(path):
            shutil.copy(filedir,path)
        else:
            print("path not exist")
    else:
        print("list")
        [shutil.copy(filedir,copy_path) for copy_path in path if os.path.exists(copy_path)]


log_dir = list_dir(paths,log_dir_name)
copy_file(log_file,log_dir)

import runpy
py_name = get_name_from_dir(log_file)
for run_log in log_dir:
    os.chdir(run_log)
    runpy.run_path(py_name)
    
import re
import numpy as np
def read_file(filename):
    with open(filename) as f:
        content = f.read()
        ret = re.findall("t = (.*) c = (.*)",content)
        all_value = np.array(ret,dtype=float)
        value = np.mean(all_value,axis=0)
        print(value)
  
  
import time

for ff in log_dir:
    t = os.path.getctime(os.path.dirname(ff))
    timeArray = time.localtime(t)
    otherStyleTime = time.strftime("%Y--%m--%d %H:%M:%S", timeArray)
    print(otherStyleTime)
    read_file(os.path.join(ff,"testpy.py"))
    print("------------------------------------------------------------")
    
